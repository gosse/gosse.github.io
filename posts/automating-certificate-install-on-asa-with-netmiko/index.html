<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Automating Certificate Install on ASA with Netmiko</title><meta name=description content><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/rss+xml href=https://next-hop-self.com/index.xml title=next-hop-self><meta name=twitter:card content="summary"><meta name=twitter:title content="Automating Certificate Install on ASA with Netmiko"><meta name=twitter:description content="Here is a little script I wrote to automate putting certificates onto ASAs. It also activates the cert on the inside interface (mine is a one-armed VPN concentrator). The cert is assumed to already in the correct format and named asabase64.cert."><link rel=stylesheet href=https://next-hop-self.com/fontawesome/css/all.min.css><link crossorigin=anonymous href=/css/styles.min.css integrity rel="preload stylesheet" as=style><link rel=stylesheet href=https://next-hop-self.com/css/custom.css><link rel=stylesheet href=https://next-hop-self.com/css/syntax.css><link id=dark-mode-theme crossorigin=anonymous href=/css/dark.min.css integrity rel="preload stylesheet" as=style><script>var darkTheme=document.getElementById("dark-mode-theme"),storedTheme=localStorage.getItem("dark-mode-storage");storedTheme==="dark"?darkTheme.disabled=!1:storedTheme==="light"&&(darkTheme.disabled=!0)</script><script defer crossorigin=anonymous src=/js/theme.js integrity></script>
<script defer crossorigin=anonymous src=/js/instantpage.min.js integrity></script><meta name=generator content="Hugo 0.101.0"></head><body><header><nav class=navbar><div class=nav><a href=https://next-hop-self.com/ class=nav-logo><img src=https://next-hop-self.com/images/ width=50 height=50 alt=Logo></a><ul class=nav-links><li><a href=/about/ id=About><em class="fas fa-user fa-lg"></em></a></li><li><a href=/tags id=Tags><em class="fas fa-tag fa-lg"></em></a></li><li><a href=/categories id=Category><em class="fas fa-folder-open fa-lg"></em></a></li></ul></div></nav><div class=intro-header><div class=container><div class=posts-heading><h1>Automating Certificate Install on ASA with Netmiko</h1></div></div></div></header><div class=container role=main><article class=article class=blog-post><p>Here is a little script I wrote to automate putting certificates onto ASAs. It also activates the cert on the inside interface (mine is a one-armed VPN concentrator). The cert is assumed to already in the correct format and named asabase64.cert.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-no-highlight data-lang=no-highlight><span class=line><span class=cl>#!/usr/bin/env python3
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>from netmiko import Netmiko
</span></span><span class=line><span class=cl>import base64
</span></span><span class=line><span class=cl>import datetime
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># connection config for netmiko 
</span></span><span class=line><span class=cl>asav = {
</span></span><span class=line><span class=cl>&#34;host&#34;: &#34;hostname&#34;,
</span></span><span class=line><span class=cl>&#34;username&#34;: &#34;user&#34;,
</span></span><span class=line><span class=cl>&#34;password&#34;: &#34;pass&#34;,
</span></span><span class=line><span class=cl>&#34;device_type&#34;: &#34;cisco_asa&#34;,
</span></span><span class=line><span class=cl>&#34;secret&#34;: &#34;enable secret&#34;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># open and read the cert 
</span></span><span class=line><span class=cl>with open(&#34;asabase64.cert&#34;, &#34;r&#34;) as f: 
</span></span><span class=line><span class=cl>cert = f.read().splitlines()
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># name the cert with today&#39;s date 
</span></span><span class=line><span class=cl># this helps when pushing a new cert 
</span></span><span class=line><span class=cl># to not have a namespace overlap 
</span></span><span class=line><span class=cl>today = datetime.datetime.now().strftime(&#34;%d-%m-%Y&#34;)
</span></span><span class=line><span class=cl>certname = today + &#34;starcert&#34;
</span></span><span class=line><span class=cl>certcmd = &#34;crypto ca import &#34; + certname + &#34; pkcs12 asaexportpass&#34;
</span></span><span class=line><span class=cl># build the commands needed to install the cert
</span></span><span class=line><span class=cl>commands = []
</span></span><span class=line><span class=cl>commands.append(&#34;conf t&#34;)
</span></span><span class=line><span class=cl>commands.append(certcmd)
</span></span><span class=line><span class=cl>commands = commands + cert
</span></span><span class=line><span class=cl>commands.append(&#34;&#34;)
</span></span><span class=line><span class=cl>commands.append(&#34;quit&#34;)
</span></span><span class=line><span class=cl>trustpoint = &#34;ssl trust-point &#34; + certname + &#34; inside&#34;
</span></span><span class=line><span class=cl>commands.append(trustpoint)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># connect to the firewall 
</span></span><span class=line><span class=cl>net_connect = Netmiko(**asav)
</span></span><span class=line><span class=cl>print(net_connect.find_prompt())
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># always a good test 
</span></span><span class=line><span class=cl>output = net_connect.send_command_timing(&#34;show int ip br&#34;)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># send the commands
</span></span><span class=line><span class=cl>for command in commands:
</span></span><span class=line><span class=cl>print(command)
</span></span><span class=line><span class=cl>net_connect.send_command_timing(command)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># clean up 
</span></span><span class=line><span class=cl>net_connect.disconnect()
</span></span></code></pre></div><div class=blog-tags><a href=https://next-hop-self.com/tags/asa/>asa</a>&nbsp;
<a href=https://next-hop-self.com/tags/automation/>automation</a>&nbsp;
<a href=https://next-hop-self.com/tags/cisco/>cisco</a>&nbsp;
<a href=https://next-hop-self.com/tags/networking/>networking</a>&nbsp;
<a href=https://next-hop-self.com/tags/security/>security</a>&nbsp;</div></article></div><footer><div class=social-icons><a href=https://www.linkedin.com/in/gossew/ name=LinkedIn><em class="fab fa-linkedin"></em></a>
&nbsp;&ndash;&nbsp;
<a href=https://github.com/gosse name=GitHub><em class="fab fa-github"></em></a>
&nbsp;&ndash;&nbsp;
<a href=https://twitter.com/gossewaa name=Twitter><em class="fab fa-twitter"></em></a></div><div class=container><p class="credits copyright"><a href=https://next-hop-self.com/about>Gary Ossewaarde</a>
&nbsp;&copy;
2021
&nbsp;/&nbsp;
<a href=https://next-hop-self.com/>next-hop-self</a>
&nbsp;&ndash;&nbsp;
<em class="fas fa-moon" id=dark-mode-toggle></em></p><p class="credits theme-by"><a href=https://gohugo.io>Hugo</a>&nbsp;
<a href=https://github.com/matsuyoshi30/harbor>Harbor</a></p></div></footer></body></html>